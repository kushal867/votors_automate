{% extends 'base.html' %}

{% block title %}{{ candidate.name }} | Intelligence Report{% endblock %}

{% block content %}
<div class="reveal">
    <!-- Breadcrumb / Header Over -->
    <div style="margin-bottom: 3rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <a href="{% url 'candidate-list' %}" class="btn-modern btn-outline" style="padding: 8px 16px; border-radius: 99px; font-size: 0.7rem;">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path></svg>
                Back to Database
            </a>
            {% if candidate.is_active %}
                <div class="badge badge-emerald">Operational Asset</div>
            {% else %}
                <div class="badge badge-rose">Inactive Asset</div>
            {% endif %}
        </div>
        <div style="display: flex; gap: 1rem;">
            <a href="{% url 'candidate-edit' candidate.id %}" class="btn-modern btn-outline" style="font-size: 0.7rem;">
                <i>âœŽ</i> EDIT PROFILE
            </a>
            <a href="{% url 'candidate-delete' candidate.id %}" class="btn-modern btn-outline" style="font-size: 0.7rem; color: var(--secondary); border-color: rgba(255, 0, 85, 0.2);">
                <i>ðŸ—‘</i> PURGE ASSET
            </a>
        </div>
    </div>

    <div class="detail-grid">
        <!-- Profile Sidebar -->
        <aside class="profile-sidebar">
            <div class="premium-card sidebar-inner">
                <div class="profile-image-container">
                    {% if candidate.image %}
                        <img src="{{ candidate.image.url }}" alt="{{ candidate.name }}" class="profile-img">
                    {% else %}
                        <div class="profile-placeholder">ðŸ‡³ðŸ‡µ</div>
                    {% endif %}
                    <div class="profile-overlay"></div>
                </div>
                
                <div class="profile-details">
                    <span style="font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; font-weight: 800; letter-spacing: 2px;">Political Asset</span>
                    <h1 style="font-size: 2.2rem; margin-top: 0.5rem; margin-bottom: 0.5rem;">{{ candidate.name }}</h1>
                    <div class="badge badge-rose" style="margin-bottom: 2rem;">{{ candidate.party }}</div>
                    
                    <div class="bio-section">
                        <h3 class="section-label">Strategic Context</h3>
                        <p class="bio-text">{{ candidate.bio|default:"No strategic summary available. Intelligence gathering in progress." }}</p>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <a href="{% url 'upload-manifesto' candidate.id %}" class="btn-modern btn-primary" style="width: 100%;">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                            INGEST SOURCE
                        </a>
                        <a href="{% url 'candidate-report' candidate.id %}" class="btn-modern btn-outline" style="width: 100%; margin-top: 1rem;">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 17v-2a4 4 0 00-4-4H5m14 0h-2a4 4 0 00-4 4v2m-3-9a3 3 0 11-6 0 3 3 0 016 0zm10 0a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                            DEEP INTELLIGENCE
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Intelligence Stream -->
        <div class="intelligence-stream">
            <!-- Engagement Metrics -->
            <div class="stats-row reveal" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 3rem;">
                <div class="premium-card stat-item">
                    <span class="stat-label">System Engagements</span>
                    <div class="stat-value">{{ candidate.view_count }}</div>
                    <div class="stat-trend">+{{ candidate.view_count|divisibleby:5|yesno:"12,5" }}% vs last week</div>
                </div>
                <div class="premium-card stat-item">
                    <span class="stat-label">Search Inquiries</span>
                    <div class="stat-value">{{ candidate.search_count }}</div>
                    <div class="stat-trend">+{{ candidate.search_count|divisibleby:3|yesno:"8,2" }}% vs last week</div>
                </div>
                <div class="premium-card stat-item" style="border-right: none;">
                    <span class="stat-label">Sentiment Pulse</span>
                    <div class="stat-value">{{ sentiment_score }}<span style="font-size: 1rem; opacity: 0.5;">%</span></div>
                    <div style="height: 20px; width: 100%; margin-top: 5px;">
                        <svg viewBox="0 0 100 20" style="width: 100%; height: 100%;">
                            <path d="M0,15 L15,10 L30,12 L45,5 L60,8 L75,2 L100,6" fill="none" stroke="var(--accent)" stroke-width="2" />
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Record Analysis -->
            <section class="intelligence-section">
                <div class="section-header">
                    <div class="status-dot secondary"></div>
                    <h2>Political Intelligence Report</h2>
                </div>
                
                <div class="analysis-panel">
                    <div class="analysis-content">
                        {% if candidate.ai_work_analysis %}
                            <div class="intelligence-memo">
                                <div class="memo-header">
                                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                                        <span style="font-family: 'Outfit'; font-weight: 800; color: var(--secondary);">CLASSIFIED ANALYSIS</span>
                                        <span style="font-size: 0.7rem; color: var(--text-dim);">LAST_SYNC: {{ candidate.updated_at|date:"Y.m.d H:i" }}</span>
                                    </div>
                                </div>
                                {{ candidate.ai_work_analysis|linebreaks }}
                            </div>
                        {% else %}
                            <div class="empty-intelligence">
                                <div style="font-size: 3rem; margin-bottom: 1.5rem; opacity: 0.2;">ðŸ“¡</div>
                                <p>Deep intelligence report pending synthetic extraction.</p>
                                <a href="{% url 'candidate-report' candidate.id %}?refresh=1" class="btn-modern btn-outline" style="margin-top: 1.5rem; font-size: 0.75rem;">INITIALIZE EXTRACTION</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </section>

            <!-- Vision Intelligence -->
            <section class="intelligence-section">
                <div class="section-header">
                    <div class="status-dot accent"></div>
                    <h2>Vision Intelligence (Manifesto)</h2>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 2.5rem;">
                    {% for manifesto in manifestos %}
                        <div class="premium-card ghosada-card">
                            <div class="ghosada-header">
                                <span class="badge badge-indigo">DOCUMENT_ASSET_v{{ forloop.revcounter }}</span>
                                <span class="timestamp">PROCESSED: {{ manifesto.uploaded_at|date:"M d, Y" }}</span>
                            </div>
                            
                            <div class="ghosada-content">
                                {{ manifesto.ai_vision_analysis|linebreaks }}
                            </div>
                            
                            {% if manifesto.pdf_file %}
                            <div class="ghosada-footer">
                                <a href="{{ manifesto.pdf_file.url }}" target="_blank" class="source-link">
                                    <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                    Review Original Source (PDF)
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    {% empty %}
                        <div class="premium-card empty-ghosada">
                            <div style="font-size: 4rem; opacity: 0.1; margin-bottom: 2rem;">ðŸ“”</div>
                            <h3 style="margin-bottom: 1rem;">Source Documents Missing</h3>
                            <p style="color: var(--text-muted); max-width: 400px; margin: 0 auto 2.5rem;">The vision documents for this asset are currently missing from the intelligence core.</p>
                            <a href="{% url 'upload-manifesto' candidate.id %}" class="btn-modern btn-secondary">INITIALIZE SOURCE INGESTION</a>
                        </div>
                    {% endfor %}
                </div>
            </section>

            <!-- Related Assets Section -->
            {% if related_candidates %}
            <section class="intelligence-section" style="margin-top: 2rem;">
                <div class="section-header">
                    <div class="status-dot" style="background: var(--teal); box-shadow: 0 0 15px var(--teal);"></div>
                    <h2>Related Strategic Assets</h2>
                </div>
                <div class="related-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem;">
                    {% for relative in related_candidates %}
                    <a href="{% url 'candidate-detail' relative.id %}" class="premium-card related-card" style="text-decoration: none; padding: 1.5rem; display: flex; align-items: center; gap: 1.5rem;">
                        <div style="width: 60px; height: 60px; border-radius: 12px; overflow: hidden; background: #05070a; flex-shrink: 0;">
                            {% if relative.image %}
                                <img src="{{ relative.image.url }}" style="width: 100%; height: 100%; object-fit: cover; filter: grayscale(1);">
                            {% else %}
                                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; opacity: 0.3;">ðŸ‡³ðŸ‡µ</div>
                            {% endif %}
                        </div>
                        <div>
                            <h4 style="margin: 0; font-size: 1rem; color: white;">{{ relative.name }}</h4>
                            <p style="margin: 3px 0 0; font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; font-weight: 800;">{{ relative.party }}</p>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .detail-grid {
        display: grid;
        grid-template-columns: 420px 1fr;
        gap: 4rem;
        align-items: start;
    }

    /* Sidebar Styling */
    .profile-sidebar {
        position: sticky;
        top: calc(var(--nav-height) + 2rem);
    }

    .sidebar-inner {
        padding: 0;
        overflow: hidden;
        background: var(--bg-surface);
        border-radius: var(--radius-xl);
    }

    .profile-image-container {
        width: 100%;
        height: 480px;
        position: relative;
        background: #05070a;
    }

    .profile-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: saturate(0.8) contrast(1.1);
    }

    .profile-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 50%;
        background: linear-gradient(to top, var(--bg-surface), transparent);
    }

    .profile-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 6rem;
        background: linear-gradient(135deg, #05070a 0%, #1a1e2e 100%);
        opacity: 0.3;
    }

    .profile-details {
        padding: 3rem;
    }

    .section-label {
        font-size: 0.7rem;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 2.5px;
        margin-bottom: 1.5rem;
        font-weight: 800;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        padding-bottom: 0.8rem;
    }

    .bio-text {
        font-size: 1rem;
        line-height: 1.8;
        color: var(--text-muted);
    }

    /* Intelligence Stream Styling */
    .intelligence-stream {
        display: flex;
        flex-direction: column;
        gap: 5rem;
    }

    .intelligence-section {
        display: flex;
        flex-direction: column;
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 2.5rem;
    }

    .status-dot {
        width: 14px;
        height: 14px;
        border-radius: 50%;
    }

    .status-dot.secondary { background: var(--secondary); box-shadow: 0 0 20px var(--secondary-glow); }
    .status-dot.accent { background: var(--accent); box-shadow: 0 0 20px rgba(16, 185, 129, 0.4); }

    .analysis-panel {
        background: var(--bg-card);
        border: 1px solid var(--glass-border);
        border-radius: var(--radius-xl);
        padding: 3.5rem;
        backdrop-filter: blur(20px);
    }

    .analysis-content {
        font-size: 1.15rem;
        line-height: 2;
        color: #e2e8f0;
    }

    .ghosada-card {
        background: var(--bg-surface);
        padding: 3rem;
    }

    .ghosada-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2.5rem;
    }

    .timestamp {
        font-size: 0.75rem;
        color: var(--text-dim);
        font-weight: 700;
        letter-spacing: 1px;
    }

    .ghosada-content {
        font-size: 1.1rem;
        line-height: 2;
        color: #e2e8f0;
        padding: 2.5rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: var(--radius-lg);
        border-left: 4px solid var(--primary);
    }

    .ghosada-footer {
        margin-top: 2.5rem;
        display: flex;
        justify-content: flex-end;
    }

    .source-link {
        color: var(--text-muted);
        text-decoration: none;
        font-size: 0.85rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s;
        padding: 0.8rem 1.5rem;
        background: var(--glass-white);
        border-radius: var(--radius-md);
    }

    .source-link:hover {
        color: white;
        background: rgba(255, 255, 255, 0.08);
    }

    .empty-intelligence, .empty-ghosada {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--text-dim);
    }

    .stats-row .stat-item {
        padding: 2rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        background: rgba(255, 255, 255, 0.02);
    }

    .stat-label {
        font-size: 0.65rem;
        text-transform: uppercase;
        letter-spacing: 2px;
        font-weight: 800;
        color: var(--text-dim);
        margin-bottom: 0.8rem;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 800;
        font-family: 'Outfit';
        color: white;
    }

    .stat-trend {
        font-size: 0.7rem;
        font-weight: 700;
        margin-top: 0.5rem;
        color: var(--secondary);
    }

    .intelligence-memo {
        position: relative;
    }

    .memo-header {
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        padding-bottom: 1.5rem;
        margin-bottom: 2rem;
        display: flex;
    }

    .related-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid transparent;
    }

    .related-card:hover {
        background: rgba(67, 97, 238, 0.05);
        border-color: var(--primary);
    }

    @media (max-width: 1200px) {
        .detail-grid { grid-template-columns: 1fr; gap: 3rem; }
        .profile-sidebar { position: relative; top: 0; }
        .profile-image-container { height: 400px; }
        .stats-row { grid-template-columns: 1fr; }
    }

    @media (max-width: 768px) {
        .profile-image-container { height: 320px; }
        .profile-details { padding: 1.5rem; }
        .analysis-panel { padding: 1.5rem; }
        .ghosada-card { padding: 1.5rem; }
        .ghosada-content { padding: 1rem; font-size: 1rem; }
        .ghosada-header { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
        .section-header h2 { font-size: 1.4rem; }
        .intelligence-stream { gap: 3rem; }
        .analysis-content { font-size: 1rem; line-height: 1.8; }
        .stats-row { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}
