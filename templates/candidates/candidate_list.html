{% extends 'base.html' %}

{% block title %}Intelligence Database | Voter Vision AI{% endblock %}

{% block content %}
<div class="reveal">
    <!-- Sophisticated Header -->
    <div class="header-section" style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5rem; flex-wrap: wrap; gap: 2rem;">
        <div style="max-width: 600px;">
            <div class="badge badge-indigo" style="margin-bottom: 1.5rem;">SECURE DATABASE v3.0</div>
            {% if is_search %}
                <h1 class="gradient-text list-title">Intelligence Search</h1>
                <p style="color: var(--text-muted); font-size: 1.1rem; font-weight: 500;">
                    Found {{ candidates|length }} assets matching query: <span style="color: white; font-weight: 800;">"{{ search_query }}"</span>
                </p>
            {% else %}
                <h1 class="gradient-text list-title">Political Assets</h1>
                <p style="color: var(--text-muted); font-size: 1.1rem; font-weight: 500;">
                    Exploring verified leadership profiles and strategic political maneuvers across Nepal's federal landscape.
                </p>
            {% endif %}
        </div>
        <div class="header-actions" style="display: flex; gap: 1rem; align-items: center; margin-bottom: 0.5rem; width: 100%; max-width: 600px;">
            <select onchange="location.href='?province=' + this.value" class="btn-modern btn-outline" style="flex: 1; text-align: left; appearance: none; -webkit-appearance: none;">
                <option value="">All Provinces</option>
                {% for code, name in provinces %}
                    <option value="{{ code }}" {% if selected_province == code %}selected{% endif %}>{{ name }}</option>
                {% endfor %}
            </select>
            <button onclick="document.getElementById('compareForm').submit()" class="btn-modern btn-outline" style="flex: 1;">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
                Compare
            </button>
            <a href="{% url 'candidate-add' %}" class="btn-modern btn-primary" style="flex: 1;">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"></path></svg>
                New Asset
            </a>
        </div>
    </div>

    <form id="compareForm" action="{% url 'compare-candidates' %}" method="get">
        <div class="candidate-grid">
            {% for candidate in candidates %}
            <div class="premium-card candidate-card">
                <!-- Select Toggle Overlay -->
                <div class="card-selection-overlay">
                    <label class="custom-checkbox">
                        <input type="checkbox" name="compare" value="{{ candidate.id }}">
                        <span class="checkmark"></span>
                    </label>
                </div>
                
                <!-- Visual Identity Section -->
                <div class="card-visual">
                    {% if candidate.image %}
                        <img src="{{ candidate.image.url }}" alt="{{ candidate.name }}" class="card-img">
                    {% else %}
                        <div class="card-img-placeholder">
                            <span style="font-size: 4rem; filter: grayscale(1); opacity: 0.1;">üèîÔ∏è</span>
                        </div>
                    {% endif %}
                    
                    <div class="card-visual-overlay">
                        <div class="badge badge-rose" style="backdrop-filter: blur(8px); border-color: rgba(244, 63, 94, 0.4);">
                            {{ candidate.party }}
                        </div>
                        {% if candidate.is_featured %}
                            <div class="badge badge-gold" style="background: rgba(255, 204, 0, 0.1); color: var(--gold); border: 1px solid var(--gold); margin-left: 0.5rem; backdrop-filter: blur(8px);">FEATURED</div>
                        {% endif %}
                    </div>
                </div>

                <!-- Intelligence Profile Content -->
                <div class="card-body">
                    <div style="margin-bottom: 1.5rem;">
                        <span style="font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; font-weight: 800; letter-spacing: 2px;">Asset Profile</span>
                        <h2 style="font-size: 2rem; margin-top: 0.2rem; margin-bottom: 0.8rem;">{{ candidate.name }}</h2>
                        <p style="color: var(--text-muted); font-size: 0.95rem; line-height: 1.8; height: 5.4em; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; line-clamp: 3;">
                            {{ candidate.bio|default:"No strategic summary available for this asset. Detailed intelligence gathering in progress." }}
                        </p>
                    </div>
                    
                    <div class="card-actions">
                        <a href="{% url 'candidate-detail' candidate.id %}" class="btn-modern btn-outline" style="flex: 1.5;">ANALYZE</a>
                        <div style="display: flex; gap: 0.5rem;">
                            <a href="{% url 'candidate-edit' candidate.id %}" class="btn-modern btn-outline" style="padding: 10px; min-width: 40px;" title="Edit Asset"><i>‚úé</i></a>
                            <a href="{% url 'candidate-delete' candidate.id %}" class="btn-modern btn-outline" style="padding: 10px; min-width: 40px; color: var(--secondary); border-color: rgba(255, 0, 85, 0.2);" title="Delete Asset"><i>üóë</i></a>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <a href="{% url 'upload-manifesto' candidate.id %}" class="btn-modern btn-secondary" style="width: 100%;">INGEST GHOSADA</a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="premium-card reveal" style="grid-column: 1 / -1; text-align: center; padding: 10rem 2rem; border-radius: 40px; background: rgba(99, 102, 241, 0.02); border-style: dashed;">
                <div style="font-size: 5rem; margin-bottom: 2rem; filter: drop-shadow(0 0 20px var(--primary-glow));">üì°</div>
                <h2 style="margin-bottom: 1rem; font-size: 2.5rem;">No Intelligence Assets</h2>
                <p style="color: var(--text-muted); max-width: 500px; margin: 0 auto 3.5rem; font-size: 1.2rem;">Start building your election database by registering the first political candidate for synthesis.</p>
                <a href="{% url 'candidate-add' %}" class="btn-modern btn-primary" style="padding: 1.5rem 3.5rem; font-size: 1.1rem;">INITIALIZE FIRST ASSET</a>
            </div>
            {% endfor %}
        </div>
    </form>
</div>

<style>
    .candidate-card {
        padding: 0;
        display: flex;
        flex-direction: column;
        border-radius: var(--radius-xl);
        height: 100%;
    }

    .card-visual {
        height: 300px;
        overflow: hidden;
        position: relative;
        background: var(--bg-surface);
    }

    .card-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 1s cubic-bezier(0.2, 0.8, 0.2, 1);
        filter: saturate(0.8) contrast(1.1);
    }

    .candidate-card:hover .card-img {
        transform: scale(1.1) rotate(0.5deg);
        filter: saturate(1.1) contrast(1.1);
    }

    .card-img-placeholder {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background: linear-gradient(135deg, #0a0e1a 0%, #1a1e2e 100%);
    }

    .card-visual-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        padding: 2.5rem;
        background: linear-gradient(to top, var(--bg-surface), transparent);
        z-index: 2;
    }

    .card-body {
        padding: 2.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
        background: var(--bg-surface);
        position: relative;
        z-index: 3;
    }

    .card-actions {
        display: flex;
        gap: 1.2rem;
        margin-top: auto;
        padding-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* Selection Overlay */
    .card-selection-overlay {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        z-index: 10;
    }

    .custom-checkbox {
        display: block;
        position: relative;
        cursor: pointer;
        width: 28px;
        height: 28px;
    }

    .custom-checkbox input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
    }

    .checkmark {
        position: absolute;
        top: 0;
        left: 0;
        height: 28px;
        width: 28px;
        background: rgba(0, 0, 0, 0.4);
        border: 1.5px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        backdrop-filter: blur(10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .custom-checkbox:hover input ~ .checkmark {
        background: rgba(255, 255, 255, 0.1);
        border-color: white;
    }

    .custom-checkbox input:checked ~ .checkmark {
        background: var(--primary);
        border-color: var(--primary);
        box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
    }

    .checkmark:after {
        content: "";
        position: absolute;
        display: none;
        left: 9px;
        top: 5px;
        width: 6px;
        height: 11px;
        border: solid white;
        border-width: 0 2.5px 2.5px 0;
        transform: rotate(45deg);
    }

    .custom-checkbox input:checked ~ .checkmark:after {
        display: block;
    }

    /* Responsive Adjustments */
    .candidate-grid {
        display: grid; 
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); 
        gap: 3rem;
    }

    @media (max-width: 768px) {
        .candidate-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        .header-section {
            margin-bottom: 3rem !important;
        }
        .list-title {
            font-size: 2.5rem !important;
        }
        .header-actions {
            max-width: 100% !important;
        }
        .card-visual {
            height: 220px;
        }
        .card-body {
            padding: 1.5rem;
        }
    }
</style>
{% endblock %}
